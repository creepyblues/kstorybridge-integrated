import{j as e}from"./ui-DHaiO8z9.js";import{r}from"./vendor-BZF0HjbR.js";import{L as D}from"./router-DmKwpzBq.js";import{D as K,e as Q,B as d,f as W,g as X,h as Y,o as Z,I as E,m as I,n as ee,p as te,q as ae,r as P,s as o,t as se,v as c}from"./shared-oRVCA-__.js";import{t as re}from"./titlesService-By90PFm-.js";import{f as x}from"./featuredService-5b0xOyqp.js";import{A as le}from"./AdminLayout-CwNS1qxs.js";import{u as i}from"./index-DaSXcfrj.js";import{P as ie,i as z,o as ne,T as de}from"./icons-BVWbeyA4.js";import"./utils-CfDMlrKu.js";import"./index-DGmbjBI7.js";import"./backend-DY5GQkp5.js";function ve(){const[b,H]=r.useState([]),[R,U]=r.useState([]),[h,$]=r.useState(""),[B,_]=r.useState(!0),[w,N]=r.useState(null),[k,g]=r.useState(""),[O,f]=r.useState(!1),[y,T]=r.useState(""),[l,A]=r.useState(null),[C,S]=r.useState("");r.useEffect(()=>{u()},[]);const u=async()=>{try{_(!0);const[t,a]=await Promise.all([x.getAllFeatured(),re.getAllTitles()]);H(t),U(a)}catch(t){console.error("Error loading data:",t),i.error("Failed to load data")}finally{_(!1)}},G=async(t,a)=>{if(confirm(`Remove "${a}" from featured titles?`))try{await x.removeFeaturedTitle(t),await u(),i.success("Title removed from featured")}catch(s){console.error("Error removing featured title:",s),i.error("Failed to remove featured title")}},M=async t=>{try{await x.updateFeaturedNote(t,k),N(null),g(""),await u(),i.success("Note updated successfully")}catch(a){console.error("Error updating note:",a),i.error("Failed to update note")}},V=async()=>{if(!l){i.error("Please select a title");return}try{if(await x.isTitleFeatured(l.title_id)){i.error("This title is already featured");return}await x.addFeaturedTitle(l.title_id,C),f(!1),A(null),S(""),T(""),await u(),i.success("Title added to featured")}catch(t){console.error("Error adding featured title:",t),i.error("Failed to add featured title")}},q=(t,a)=>{N(t),g(a||"")},J=()=>{N(null),g("")},v=b.filter(t=>{var n,m,j,L;if(!h)return!0;const a=h.toLowerCase(),s=t.titles;return((n=s.title_name_en)==null?void 0:n.toLowerCase().includes(a))||((m=s.title_name_kr)==null?void 0:m.toLowerCase().includes(a))||((j=t.note)==null?void 0:j.toLowerCase().includes(a))||((L=s.genre)==null?void 0:L.toLowerCase().includes(a))}),F=R.filter(t=>{var n,m;const a=!b.some(j=>j.title_id===t.title_id);if(!y)return a;const s=y.toLowerCase();return a&&(((n=t.title_name_en)==null?void 0:n.toLowerCase().includes(s))||((m=t.title_name_kr)==null?void 0:m.toLowerCase().includes(s)))}),p=t=>Array.isArray(t)?t.map(a=>a.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())).join(", "):t.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase());return e.jsx(le,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-midnight-ink",children:"Featured Titles"}),e.jsx("p",{className:"text-sm text-midnight-ink-600 mt-1",children:"Manage which titles are featured on the homepage"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-midnight-ink-600 text-sm text-right",children:e.jsxs("div",{className:"font-medium",children:[v.length," featured titles"]})}),e.jsxs(K,{open:O,onOpenChange:f,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(d,{className:"bg-hanok-teal hover:bg-hanok-teal/90 text-white",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add Featured Title"]})}),e.jsxs(W,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Add Featured Title"}),e.jsx(Z,{children:"Search and select a title to add to the featured collection."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Search Titles"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(E,{placeholder:"Search for titles to add...",value:y,onChange:t=>T(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto border rounded-lg",children:[F.slice(0,20).map(t=>e.jsxs("div",{className:`p-3 border-b cursor-pointer hover:bg-gray-50 ${(l==null?void 0:l.title_id)===t.title_id?"bg-hanok-teal/10":""}`,onClick:()=>A(t),children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.title_name_en||t.title_name_kr}),t.title_name_en&&t.title_name_kr&&e.jsx("div",{className:"text-sm text-gray-500",children:t.title_name_kr}),t.genre&&(Array.isArray(t.genre)?t.genre.length>0:!0)&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[Array.isArray(t.genre)?t.genre.slice(0,2).map((a,s)=>e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs",children:p(a)},s)):e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs",children:p(t.genre)}),Array.isArray(t.genre)&&t.genre.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",t.genre.length-2]})]})]},t.title_id)),F.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No available titles found"})]}),l&&e.jsxs("div",{className:"p-3 bg-hanok-teal/5 border border-hanok-teal/20 rounded-lg",children:[e.jsxs("div",{className:"font-medium text-gray-800 mb-2",children:["Selected: ",l.title_name_en||l.title_name_kr]}),e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Note (optional)"}),e.jsx(I,{placeholder:"Add a note about why this title is featured...",value:C,onChange:t=>S(t.target.value),className:"min-h-[80px]"})]})]}),e.jsxs(ee,{children:[e.jsx(d,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(d,{onClick:V,disabled:!l,className:"bg-hanok-teal hover:bg-hanok-teal/90",children:"Add to Featured"})]})]})]})]})]}),e.jsxs("div",{className:"relative mb-8",children:[e.jsx(z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-midnight-ink-400 w-5 h-5"}),e.jsx(E,{type:"text",placeholder:"Search featured titles...",value:h,onChange:t=>$(t.target.value),className:"w-full pl-12 pr-4 py-4 text-lg bg-porcelain-blue-50 border-0 rounded-2xl outline-none focus:ring-2 focus:ring-hanok-teal text-midnight-ink"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:B?e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:"Loading featured titles..."}):v.length>0?e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(P,{className:"bg-gray-50",children:[e.jsx(o,{className:"w-20",children:"Image"}),e.jsx(o,{className:"w-80",children:"Title"}),e.jsx(o,{className:"w-32",children:"Genre"}),e.jsx(o,{className:"flex-1",children:"Note"}),e.jsx(o,{className:"w-32",children:"Added"}),e.jsx(o,{className:"w-32",children:"Actions"})]})}),e.jsx(se,{children:v.map(t=>{const a=t.titles;return e.jsxs(P,{className:"hover:bg-gray-50",children:[e.jsx(c,{children:e.jsx(D,{to:`/titles/${a.title_id}`,children:a.title_image?e.jsx("div",{className:"w-12 h-16 bg-gray-200 rounded-lg overflow-hidden",children:e.jsx("img",{src:a.title_image,alt:a.title_name_en||a.title_name_kr,className:"w-full h-full object-cover",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.parentElement.classList.add("flex","items-center","justify-center"),s.currentTarget.parentElement.innerHTML='<span class="text-xs text-gray-400">No Image</span>'}})}):e.jsx("div",{className:"w-12 h-16 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})})}),e.jsx(c,{children:e.jsxs(D,{to:`/titles/${a.title_id}`,className:"hover:text-hanok-teal",children:[e.jsx("div",{className:"font-medium text-gray-800",children:a.title_name_en||a.title_name_kr}),a.title_name_en&&a.title_name_kr&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:a.title_name_kr})]})}),e.jsx(c,{children:a.genre&&(!Array.isArray(a.genre)||a.genre.length>0)?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Array.isArray(a.genre)?a.genre.slice(0,2).map((s,n)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-hanok-teal/10 text-hanok-teal",children:p(s)},n)):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-hanok-teal/10 text-hanok-teal",children:p(a.genre)}),Array.isArray(a.genre)&&a.genre.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.genre.length-2]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(c,{children:w===t.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{value:k,onChange:s=>g(s.target.value),className:"min-h-[60px] text-sm",placeholder:"Add a note..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",onClick:()=>M(t.id),className:"bg-hanok-teal hover:bg-hanok-teal/90 text-white px-3 py-1 text-xs",children:"Save"}),e.jsx(d,{size:"sm",variant:"outline",onClick:J,className:"px-3 py-1 text-xs",children:"Cancel"})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:t.note||e.jsx("span",{className:"text-gray-400 italic",children:"No note"})})}),e.jsx(c,{children:e.jsx("div",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>q(t.id,t.note),disabled:w===t.id,className:"p-2",children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>G(t.id,a.title_name_en||a.title_name_kr||"Unknown Title"),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(de,{className:"w-3 h-3"})})]})})]},t.id)})})]}):e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:h?"No featured titles found matching your search.":"No featured titles available."})})]})})}export{ve as default};
