var G=Object.defineProperty;var Q=(o,r,c)=>r in o?G(o,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[r]=c;var R=(o,r,c)=>Q(o,typeof r!="symbol"?r+"":r,c);import{j as e}from"./ui-DHaiO8z9.js";import{r as b}from"./vendor-BZF0HjbR.js";import{C as N,a as f,b as w,c as y,L as g,I as u,B as j,x as z,d as E,m as K}from"./shared-oRVCA-__.js";import{A as V}from"./AdminLayout-CwNS1qxs.js";import{u as i}from"./index-DaSXcfrj.js";import{G as U,R as I,p as $,f as M,e as T,q as A,r as Y,H as J,I as X,s as q,U as B}from"./icons-BVWbeyA4.js";import"./utils-CfDMlrKu.js";import"./index-DGmbjBI7.js";import"./backend-DY5GQkp5.js";import"./router-DmKwpzBq.js";class ee{constructor(){R(this,"baseUrl");this.baseUrl="http://localhost:3001/api/scraper"}async scrapeTitle(r){try{console.log("ðŸ“¡ Calling backend scraper API:",r);const c=await fetch(`${this.baseUrl}/scrape`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:r})}),l=await c.json();return c.ok?(console.log("âœ… Backend API response:",l),l):(console.error("âŒ Backend API error:",l),{success:!1,error:l.error||`HTTP ${c.status}`,confidence:0,extractedFields:[],logs:l.logs||[`âŒ Backend API error: ${l.error||c.statusText}`]})}catch(c){console.error("âŒ Network error calling backend:",c);const l=c instanceof Error?c.message:"Unknown network error";return{success:!1,error:"Backend API unavailable",confidence:0,extractedFields:[],logs:[`âŒ Failed to connect to scraper backend: ${l}`,"ðŸ’¡ Make sure the backend server is running on port 3001","ðŸ”§ Command: cd backend && npm run dev"]}}}async healthCheck(){try{const r=await fetch(`${this.baseUrl}/health`);if(r.ok)return await r.json()}catch(r){console.warn("Backend health check failed:",r)}return null}async getPlatforms(){try{const r=await fetch(`${this.baseUrl}/platforms`);if(r.ok)return await r.json()}catch(r){console.warn("Failed to get platforms:",r)}return{platforms:[]}}async runTest(){try{const r=await fetch(`${this.baseUrl}/test`),c=await r.json();return r.ok?c:{success:!1,error:c.error||`HTTP ${r.status}`,confidence:0,extractedFields:[],logs:c.logs||[]}}catch(r){const c=r instanceof Error?r.message:"Unknown error";return{success:!1,error:"Test failed",confidence:0,extractedFields:[],logs:[`âŒ Test failed: ${c}`]}}}testKoreanNumbers(){const r=[["13.7ë§Œ",137e3],["1.2ì–µ",12e7],["5ì²œ",5e3],["999",999]];console.log("ðŸ§® Testing Korean number conversion:"),r.forEach(([c,l])=>{let t=0;const m=c.toString(),d=m.match(/([\d.]+)/);if(d){const x=parseFloat(d[1]);m.includes("ì–µ")?t=x*1e8:m.includes("ë§Œ")?t=x*1e4:m.includes("ì²œ")?t=x*1e3:t=x}const h=Math.round(t)===l;console.log(`${h?"âœ…":"âŒ"} ${c} â†’ ${Math.round(t)} (expected: ${l})`)})}}const v=new ee;function he(){const[o,r]=b.useState("https://series.naver.com/comic/detail.series?productNo=3293134"),[c,l]=b.useState(!1),[t,m]=b.useState(null),[d,h]=b.useState({}),x=["https://series.naver.com/comic/detail.series?productNo=8306797","https://comic.naver.com/webtoon/list?titleId=841324","https://page.kakao.com/content/61614855","https://webtoon.kakao.com/content/%EC%83%A4%ED%81%AC-%EC%99%80%EC%9D%B4%EB%B2%88/3616","https://series.naver.com/comic/detail.series?productNo=9935335"],O=async()=>{if(!o.trim()){i.error("Please enter a URL to scrape");return}l(!0),m(null),h({});try{console.log("ðŸ” Starting scrape for:",o);const s=await v.scrapeTitle(o);console.log("ðŸ“Š Scraping result:",s),m(s),s.success&&s.data?(h(s.data),i.success(`Scraping completed! Extracted ${s.extractedFields.length} fields with ${Math.round(s.confidence*100)}% confidence`)):i.error(s.error||"Scraping failed")}catch(s){const a=s instanceof Error?s.message:"Unknown error";m({success:!1,error:a,confidence:0,extractedFields:[]}),i.error("Scraping failed: "+a)}finally{l(!1)}},p=(s,a)=>{h(k=>({...k,[s]:a}))},_=s=>{navigator.clipboard.writeText(s),i.success("Copied to clipboard!")},D=s=>({title_name_kr:e.jsx(A,{className:"w-4 h-4"}),title_name_en:e.jsx(A,{className:"w-4 h-4"}),author:e.jsx(B,{className:"w-4 h-4"}),writer:e.jsx(B,{className:"w-4 h-4"}),illustrator:e.jsx(B,{className:"w-4 h-4"}),genre:e.jsx(q,{className:"w-4 h-4"}),title_image:e.jsx(X,{className:"w-4 h-4"}),title_url:e.jsx(U,{className:"w-4 h-4"}),likes:e.jsx(J,{className:"w-4 h-4"}),age_rating:e.jsx(T,{className:"w-4 h-4"})})[s]||e.jsx(T,{className:"w-4 h-4"}),L=s=>s>=.8?"bg-green-500":s>=.6?"bg-yellow-500":s>=.4?"bg-orange-500":"bg-red-500";return e.jsx(V,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-midnight-ink",children:"Scraper Test Lab"}),e.jsx("p",{className:"text-sm text-midnight-ink-600 mt-1",children:"Test and validate title data extraction from various platforms"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(f,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"URL Input & Testing"]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"scrape-url",children:"Target URL"}),e.jsx(u,{id:"scrape-url",value:o,onChange:s=>r(s.target.value),placeholder:"https://series.naver.com/comic/detail.series?productNo=32931",className:"text-sm"})]}),e.jsx(j,{onClick:O,disabled:c,className:"w-full bg-sunrise-coral hover:bg-sunrise-coral/90 text-white",children:c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Scraping..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Start Scraping"]})}),e.jsx(z,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Sample URLs for Testing"}),e.jsx("div",{className:"space-y-2",children:x.map((s,a)=>e.jsx("button",{onClick:()=>r(s),className:"w-full text-left text-sm text-hanok-teal hover:underline p-2 rounded border border-gray-200 hover:bg-gray-50",children:s},a))}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2",children:[e.jsx("button",{onClick:()=>{v.testKoreanNumbers(),console.log("Korean number test completed - check console for results")},className:"w-full text-sm text-purple-600 hover:underline p-2 rounded border border-purple-200 hover:bg-purple-50",children:"ðŸ§® Test Korean Number Conversion (Check Console)"}),e.jsx("button",{onClick:async()=>{const s=await v.healthCheck();s?i.success(`Backend healthy: ${s.service}`):i.error("Backend unavailable - make sure server is running")},className:"w-full text-sm text-green-600 hover:underline p-2 rounded border border-green-200 hover:bg-green-50",children:"ðŸ¥ Check Backend Health"}),e.jsx("button",{onClick:async()=>{l(!0);const s=await v.runTest();m(s),s.success&&s.data&&h(s.data),l(!1)},disabled:c,className:"w-full text-sm text-blue-600 hover:underline p-2 rounded border border-blue-200 hover:bg-blue-50 disabled:opacity-50",children:"ðŸ§ª Run Backend Test"})]})]})]})]}),t&&t.logs&&t.logs.length>0&&e.jsxs(N,{children:[e.jsx(f,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Scraping Progress Log"]})}),e.jsx(y,{children:e.jsx("div",{className:"max-h-80 overflow-y-auto bg-gray-50 rounded-lg p-3",children:e.jsx("div",{className:"space-y-1",children:t.logs.map((s,a)=>e.jsx("div",{className:"text-xs font-mono text-gray-700",children:s},a))})})})]}),t&&e.jsxs(N,{children:[e.jsx(f,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[t.success?e.jsx(M,{className:"w-5 h-5 text-green-500"}):e.jsx(T,{className:"w-5 h-5 text-red-500"}),"Scraping Results"]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:t.success?e.jsx("span",{className:"text-green-600",children:"Success"}):e.jsx("span",{className:"text-red-600",children:"Failed"})})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm text-gray-500",children:"Confidence"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${L(t.confidence)}`,style:{width:`${t.confidence*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.round(t.confidence*100),"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm text-gray-500",children:"Extracted Fields"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.extractedFields.map((s,a)=>e.jsxs(E,{variant:"secondary",className:"text-xs",children:[D(s),e.jsx("span",{className:"ml-1",children:s})]},a))})]}),t.error&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:t.error})})]})]})]}),e.jsx("div",{className:"space-y-6",children:t&&t.success&&t.data&&e.jsxs(N,{children:[e.jsx(f,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Extracted Data Editor"]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-4",children:Object.entries(d).map(([s,a])=>{if(!a&&a!==!1&&a!==0||["synopsis","logline","tagline","author","illustrator","art_author","story_author","tone","pitch","perfect_for","comps","title_name_en","tags","audience"].includes(s))return null;const Z=["description"].includes(s),F=typeof a=="boolean",W=["chapters","likes"].includes(s),P=s==="title_image",H=s==="tags"&&Array.isArray(a);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs(g,{className:"text-sm flex items-center gap-2",children:[D(s),s.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),!F&&!P&&e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>_(String(a)),className:"h-6 w-6 p-0",children:e.jsx(Y,{className:"w-3 h-3"})})]}),Z?e.jsx(K,{value:String(a),onChange:n=>p(s,n.target.value),rows:3,className:"text-sm"}):F?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!a,onChange:n=>p(s,n.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm",children:a?"Yes":"No"})]}):W?e.jsx(u,{type:"number",value:String(a),onChange:n=>p(s,parseInt(n.target.value)||0),className:"text-sm"}):H?e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{value:Array.isArray(a)?a.join(", "):"",onChange:n=>{const C=n.target.value.split(",").map(S=>S.trim()).filter(S=>S.length>0);p(s,C)},placeholder:"Enter keywords separated by commas",className:"text-sm"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Separate keywords with commas (e.g., romance, drama, webtoon)"}),Array.isArray(a)&&a.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.map((n,C)=>e.jsx(E,{variant:"outline",className:"text-xs",children:n},C))})]}):P?e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{value:String(a),onChange:n=>p(s,n.target.value),className:"text-sm"}),a&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:String(a),alt:"Title Preview",className:"w-24 h-32 object-cover rounded border",onError:n=>{n.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwIDAgOTYgMTI4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iOTYiIGhlaWdodD0iMTI4IiBmaWxsPSIjQ0NDQ0NDIi8+Cjx0ZXh0IHg9IjQ4IiB5PSI2OCIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRlciIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI0ZGRkZGRiIgZm9udC1zaXplPSIxMiI+Tm8gSW1hZ2U8L3RleHQ+Cjwvc3ZnPgo="}})})]}):e.jsx(u,{value:String(a),onChange:n=>p(s,n.target.value),className:"text-sm",disabled:s==="title_url"})]},s)})}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs(j,{onClick:async()=>{try{if((await fetch("http://localhost:3001/api/testing/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o,originalData:(t==null?void 0:t.data)||{},correctedData:d,userContext:{timestamp:new Date().toISOString(),sessionId:Date.now().toString()}})})).ok)i.success("âœ… Feedback submitted! This will improve scraper accuracy.");else throw new Error("Failed to submit feedback")}catch(s){console.error("Feedback submission failed:",s),i.error("âŒ Could not submit feedback. Data logged to console."),console.log("Corrected data:",d)}},className:"w-full bg-sunrise-coral hover:bg-sunrise-coral/90 text-white",disabled:!(t!=null&&t.data)||Object.keys(d).length===0,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Submit Corrections & Improve AI"]}),e.jsxs(j,{onClick:async()=>{try{const s=await fetch("http://localhost:3001/api/testing/test-case",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o,expectedData:d,metadata:{source:"admin_manual",difficulty:"medium",dateAdded:new Date().toISOString()}})});if(s.ok){const a=await s.json();i.success(`ðŸ§ª Test case created: ${a.testId}`)}else throw new Error("Failed to create test case")}catch(s){console.error("Test case creation failed:",s),i.error("âŒ Could not create test case")}},variant:"outline",className:"w-full border-hanok-teal text-hanok-teal hover:bg-hanok-teal hover:text-white",disabled:Object.keys(d).length===0,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Add as Test Case"]}),e.jsxs(j,{onClick:()=>{console.log("Validated data:",d),i.success("Data validated! Check console for details.")},variant:"outline",className:"w-full",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Validate & Log Data"]})]})]})]})})]})]})})}export{he as default};
