import{j as e}from"./ui-DHaiO8z9.js";import{r as d}from"./vendor-BZF0HjbR.js";import{u as M,B as N,C as m,a as x,b as g,c as u,I as s,S as y,i as C,j as w,k as _,l as r,m as S,D as Y,f as G,g as K,h as q,n as z}from"./shared-oRVCA-__.js";import{t as V}from"./titlesService-B9xRPQpD.js";import{A as T}from"./AdminLayout-nbEZqzxn.js";import{b as Q,u as X}from"./router-DmKwpzBq.js";import{j as Z,n as ee}from"./icons-BVWbeyA4.js";import"./utils-CfDMlrKu.js";import"./index-51_7LTNa.js";import"./backend-DY5GQkp5.js";function he(){const{titleId:c}=Q(),A=X(),{toast:j}=M(),[o,L]=d.useState(null),[l,D]=d.useState({}),[O,I]=d.useState(!0),[h,E]=d.useState(!1),[F,b]=d.useState(!1),[v,B]=d.useState([]);d.useEffect(()=>{c&&U(c)},[c]);const U=async t=>{try{I(!0);const n=await V.getTitleById(t);L(n),D(n)}catch(n){console.error("Error loading title:",n),j({title:"Error loading title",variant:"destructive"})}finally{I(!1)}},a=(t,n)=>{D(i=>({...i,[t]:n}))},H=t=>{const n=t.split(",").map(i=>i.trim()).filter(i=>i.length>0);a("tags",n)},W=()=>{if(!o)return[];const t=[];return Object.keys(l).forEach(n=>{const i=n,p=o[i],f=l[i];if(["title_id","created_at","updated_at"].includes(i))return;let k=!1;Array.isArray(p)&&Array.isArray(f)?k=JSON.stringify(p.sort())!==JSON.stringify(f.sort()):k=p!==f,k&&t.push({field:i,oldValue:p,newValue:f})}),t},$=t=>{t.preventDefault();const n=W();if(n.length===0){j({title:"No changes detected",description:"The form has not been modified."});return}B(n),b(!0)},P=async()=>{if(!(!c||!o))try{E(!0);const t={};v.forEach(n=>{["title_id","created_at","updated_at"].includes(n.field)||(t[n.field]=n.newValue)}),await V.updateTitle(c,t),j({title:"Title updated successfully",description:`Updated ${v.length} field${v.length>1?"s":""}`}),b(!1),A(`/titles/${c}`)}catch(t){console.error("Error updating title:",t),j({title:"Error updating title",variant:"destructive"})}finally{E(!1)}},J=t=>t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),R=t=>t==null||t===""?"Empty":Array.isArray(t)?t.join(", "):typeof t=="boolean"?t?"Yes":"No":String(t);return O?e.jsx(T,{children:e.jsx("div",{className:"text-center text-gray-600 py-8",children:"Loading title..."})}):o?e.jsx(T,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(N,{onClick:()=>A(`/titles/${c}`),variant:"ghost",className:"text-gray-600 hover:text-gray-800",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Back to Title Detail"]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-midnight-ink mb-2",children:"Edit Title"}),e.jsx("p",{className:"text-lg text-gray-500",children:o.title_name_en||o.title_name_kr})]}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"bg-white border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(x,{children:e.jsx(g,{className:"text-midnight-ink text-xl",children:"Basic Information"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Title Name (Korean)"}),e.jsx(s,{value:l.title_name_kr||"",onChange:t=>a("title_name_kr",t.target.value),placeholder:"한국어 제목"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Title Name (English)"}),e.jsx(s,{value:l.title_name_en||"",onChange:t=>a("title_name_en",t.target.value),placeholder:"English Title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Tagline"}),e.jsx(s,{value:l.tagline||"",onChange:t=>a("tagline",t.target.value),placeholder:"Brief tagline"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Genre"}),e.jsxs(y,{value:l.genre||"",onValueChange:t=>a("genre",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select genre"})}),e.jsxs(_,{children:[e.jsx(r,{value:"romance",children:"Romance"}),e.jsx(r,{value:"action",children:"Action"}),e.jsx(r,{value:"drama",children:"Drama"}),e.jsx(r,{value:"comedy",children:"Comedy"}),e.jsx(r,{value:"thriller",children:"Thriller"}),e.jsx(r,{value:"fantasy",children:"Fantasy"}),e.jsx(r,{value:"sci_fi",children:"Sci-Fi"}),e.jsx(r,{value:"horror",children:"Horror"}),e.jsx(r,{value:"slice_of_life",children:"Slice of Life"}),e.jsx(r,{value:"historical",children:"Historical"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Content Format"}),e.jsxs(y,{value:l.content_format||"",onValueChange:t=>a("content_format",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select format"})}),e.jsxs(_,{children:[e.jsx(r,{value:"webtoon",children:"Webtoon"}),e.jsx(r,{value:"web_novel",children:"Web Novel"}),e.jsx(r,{value:"manhwa",children:"Manhwa"}),e.jsx(r,{value:"novel",children:"Novel"}),e.jsx(r,{value:"short_story",children:"Short Story"})]})]})]})]})]}),e.jsxs(m,{className:"bg-white border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(x,{children:e.jsx(g,{className:"text-midnight-ink text-xl",children:"Authors & Rights"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Author (Original)"}),e.jsx(s,{value:l.author||"",onChange:t=>a("author",t.target.value),placeholder:"Original author name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Story Author"}),e.jsx(s,{value:l.story_author||"",onChange:t=>a("story_author",t.target.value),placeholder:"Story author name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Art Author"}),e.jsx(s,{value:l.art_author||"",onChange:t=>a("art_author",t.target.value),placeholder:"Art author name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Writer"}),e.jsx(s,{value:l.writer||"",onChange:t=>a("writer",t.target.value),placeholder:"Writer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Illustrator"}),e.jsx(s,{value:l.illustrator||"",onChange:t=>a("illustrator",t.target.value),placeholder:"Illustrator name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Rights"}),e.jsx(s,{value:l.rights||"",onChange:t=>a("rights",t.target.value),placeholder:"Rights information"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Rights Owner"}),e.jsx(s,{value:l.rights_owner||"",onChange:t=>a("rights_owner",t.target.value),placeholder:"Rights owner information"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"bg-white border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(x,{children:e.jsx(g,{className:"text-midnight-ink text-xl",children:"Content Description"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Synopsis"}),e.jsx(S,{value:l.synopsis||"",onChange:t=>a("synopsis",t.target.value),placeholder:"Brief synopsis of the content",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Description"}),e.jsx(S,{value:l.description||"",onChange:t=>a("description",t.target.value),placeholder:"Detailed description of the content",rows:4})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Note"}),e.jsx(S,{value:l.note||"",onChange:t=>a("note",t.target.value),placeholder:"Additional notes",rows:2})]})]})]}),e.jsxs(m,{className:"bg-white border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(x,{children:e.jsx(g,{className:"text-midnight-ink text-xl",children:"Market Information"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Perfect For"}),e.jsx(s,{value:l.perfect_for||"",onChange:t=>a("perfect_for",t.target.value),placeholder:"Target market or adaptation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Comps"}),e.jsx(s,{value:l.comps||"",onChange:t=>a("comps",t.target.value),placeholder:"Comparable titles"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Tone"}),e.jsx(s,{value:l.tone||"",onChange:t=>a("tone",t.target.value),placeholder:"Tone and mood"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Audience"}),e.jsx(s,{value:l.audience||"",onChange:t=>a("audience",t.target.value),placeholder:"Target audience"})]})]})]}),e.jsxs(m,{className:"bg-white border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(x,{children:e.jsx(g,{className:"text-midnight-ink text-xl",children:"Content Details"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Title Image URL"}),e.jsx(s,{value:l.title_image||"",onChange:t=>a("title_image",t.target.value),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Title URL"}),e.jsx(s,{value:l.title_url||"",onChange:t=>a("title_url",t.target.value),placeholder:"https://example.com/title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Pitch Document URL"}),e.jsx(s,{value:l.pitch||"",onChange:t=>a("pitch",t.target.value),placeholder:"https://example.com/pitch.pdf"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Views"}),e.jsx(s,{type:"number",value:l.views||"",onChange:t=>a("views",parseInt(t.target.value)||null),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Likes"}),e.jsx(s,{type:"number",value:l.likes||"",onChange:t=>a("likes",parseInt(t.target.value)||null),placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Rating"}),e.jsx(s,{type:"number",step:"0.1",min:"0",max:"10",value:l.rating||"",onChange:t=>a("rating",parseFloat(t.target.value)||null),placeholder:"0.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Rating Count"}),e.jsx(s,{type:"number",value:l.rating_count||"",onChange:t=>a("rating_count",parseInt(t.target.value)||null),placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Chapters"}),e.jsx(s,{type:"number",value:l.chapters||"",onChange:t=>a("chapters",parseInt(t.target.value)||null),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Completed"}),e.jsxs(y,{value:l.completed===null?"null":String(l.completed),onValueChange:t=>a("completed",t==="null"?null:t==="true"),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select status"})}),e.jsxs(_,{children:[e.jsx(r,{value:"null",children:"Not Specified"}),e.jsx(r,{value:"true",children:"Completed"}),e.jsx(r,{value:"false",children:"Ongoing"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-hanok-teal mb-2",children:"Tags (comma-separated)"}),e.jsx(s,{value:Array.isArray(l.tags)?l.tags.join(", "):"",onChange:t=>H(t.target.value),placeholder:"tag1, tag2, tag3"})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end mt-8",children:e.jsxs(N,{type:"submit",className:"bg-hanok-teal hover:bg-hanok-teal/90 text-white px-8 py-3",disabled:h,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),h?"Saving...":"Save Changes"]})})]}),e.jsx(Y,{open:F,onOpenChange:b,children:e.jsxs(G,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(q,{children:"Confirm Changes"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:['You are about to make the following changes to "',o.title_name_en||o.title_name_kr,'":']}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:v.map((t,n)=>e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-hanok-teal mb-2",children:J(t.field)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-red-600",children:"Old:"}),e.jsx("div",{className:"mt-1 p-2 bg-red-50 rounded border-l-2 border-red-200",children:R(t.oldValue)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-600",children:"New:"}),e.jsx("div",{className:"mt-1 p-2 bg-green-50 rounded border-l-2 border-green-200",children:R(t.newValue)})]})]})]},n))})]}),e.jsxs(z,{children:[e.jsx(N,{variant:"outline",onClick:()=>b(!1),disabled:h,children:"Cancel"}),e.jsx(N,{onClick:P,className:"bg-hanok-teal hover:bg-hanok-teal/90 text-white",disabled:h,children:h?"Saving...":"Confirm Changes"})]})]})})]})}):e.jsx(T,{children:e.jsx("div",{className:"text-center text-gray-600 py-8",children:"Title not found"})})}export{he as default};
