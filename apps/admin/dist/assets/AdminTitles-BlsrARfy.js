import{j as e}from"./ui-DHaiO8z9.js";import{r as m}from"./vendor-BZF0HjbR.js";import{u as Y,L as D}from"./router-DmKwpzBq.js";import{B as N,C as P,c as $}from"./shared-oRVCA-__.js";import{t as q}from"./titlesService-By90PFm-.js";import{f as X}from"./featuredService-5b0xOyqp.js";import{A as Z}from"./AdminLayout-CwNS1qxs.js";import{u as ee}from"./index-DaSXcfrj.js";import{R as ae,i as te,d as se,c as re,A as ne}from"./icons-BVWbeyA4.js";import"./utils-CfDMlrKu.js";import"./index-DGmbjBI7.js";import"./backend-DY5GQkp5.js";const _={romantasy:["romance","fantasy"],romcom:["romance","comedy"],romfan:["romance","fantasy"],scifi:["sci_fi","science_fiction"],sciencefiction:["sci_fi","science","fiction"],sliceoflife:["slice_of_life","daily","life"],sol:["slice_of_life"],bl:["boys_love","yaoi","romance"],gl:["girls_love","yuri","romance"],yaoi:["boys_love","bl","romance"],yuri:["girls_love","gl","romance"],isekai:["fantasy","adventure","reincarnation"],cultivation:["fantasy","martial_arts","adventure"],litrpg:["fantasy","game","adventure"],dystopian:["sci_fi","thriller","drama"],cyberpunk:["sci_fi","thriller","futuristic"],steampunk:["fantasy","historical","adventure"],paranormal:["supernatural","fantasy","mystery"],supernatural:["paranormal","fantasy","horror"],psychological:["thriller","horror","mystery"],wholesome:["slice_of_life","comedy","heartwarming"],fluffy:["romance","comedy","wholesome"],angsty:["drama","tragedy","emotional"],enemies2lovers:["romance","drama"],enemiestolovers:["romance","drama"],slowburn:["romance","drama"],instalove:["romance"],harem:["romance","comedy"],reverse_harem:["romance","comedy"],otome:["romance","game"],villainess:["romance","comedy","isekai"],webtoon:["manhwa","comic","webcomic"],manhwa:["webtoon","comic","korean"],manhua:["comic","chinese"],manga:["comic","japanese"],webnovel:["novel","web_novel","online"],lightnovel:["novel","light_novel","ln"],ln:["light_novel","novel"],funny:["comedy","humor","comedic"],humorous:["comedy","funny"],comedic:["comedy","funny"],dark:["horror","thriller","mature"],mature:["adult","serious","dark"],lighthearted:["comedy","wholesome","fun"],heartwarming:["wholesome","feel_good","uplifting"],feelgood:["wholesome","heartwarming","uplifting"],emotional:["drama","tearjerker","moving"],tearjerker:["drama","emotional","sad"],uplifting:["inspirational","motivational","positive"],inspiring:["uplifting","motivational"],motivational:["inspiring","uplifting"],teen:["young_adult","ya","teenage"],ya:["young_adult","teen"],youngadult:["teen","ya"],adult:["mature","grown_up"],kids:["children","family","young"],children:["kids","family","young"],family:["all_ages","wholesome"],korean:["korea","k-content","hallyu"],kdrama:["korean","drama","tv"],kpop:["korean","music","idol"],chaebol:["korean","business","rich"],historical_korean:["historical","korean","traditional"],modern_korean:["contemporary","korean","modern"]},O={fantacy:["fantasy"],fantasie:["fantasy"],romanse:["romance"],romence:["romance"],mistry:["mystery"],mistery:["mystery"],thriler:["thriller"],horor:["horror"],commedy:["comedy"],comidy:["comedy"],acton:["action"],sifi:["sci_fi"],syfy:["sci_fi"]};function ie(o,n){if(o===n)return 1;const i=f=>{const l=new Set;for(let p=0;p<f.length-1;p++)l.add(f.substring(p,p+2));return l},u=i(o.toLowerCase()),r=i(n.toLowerCase()),h=new Set([...u].filter(f=>r.has(f))),c=new Set([...u,...r]);return h.size/c.size}function le(o){const n=o.toLowerCase().trim(),i=new Set([n]);_[n]&&_[n].forEach(r=>i.add(r)),O[n]&&O[n].forEach(r=>{i.add(r),_[r]&&_[r].forEach(h=>i.add(h))});const u=[...Object.keys(_),...Object.values(_).flat(),...Object.keys(O),...Object.values(O).flat()];for(const r of u){const h=ie(n,r);h>.7&&h<1&&(i.add(r),_[r]&&_[r].forEach(c=>i.add(c)))}return Array.from(i)}function oe(o,n,i){if(!n.trim())return{exactMatches:o,expandedMatches:[]};const u=n.toLowerCase().trim().split(/\s+/),r=u.flatMap(l=>le(l)),h=new Set(u),c=new Set,f=new Set;for(const l of o){let p=!1,y=!1;for(const j of i){const g=l[j];if(!g)continue;let x="";Array.isArray(g)?x=g.join(" ").toLowerCase():typeof g=="string"?x=g.toLowerCase():x=String(g).toLowerCase();for(const w of u)if(x.includes(w)){p=!0;break}for(const w of r)!h.has(w)&&x.includes(w)&&(y=!0)}p?c.add(l):y&&f.add(l)}return{exactMatches:Array.from(c),expandedMatches:Array.from(f)}}function ce(){return["title_name_en","title_name_kr","author","story_author","art_author","writer","illustrator","rights","rights_owner","tagline","description","synopsis","note","perfect_for","comps","tone","audience","genre","tags","content_format"]}const F=({children:o,className:n=""})=>e.jsxs("div",{className:`relative ${n}`,children:[e.jsx("div",{className:"filter blur-sm select-none",children:o}),e.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-sm pointer-events-none"})]});function be(){Y();const[o,n]=m.useState([]),[i,u]=m.useState([]),[r,h]=m.useState(""),[c,f]=m.useState(""),[l,p]=m.useState(!1),[y,j]=m.useState(1),[g]=m.useState(50),[x,w]=m.useState(null),[C,R]=m.useState("asc"),[z,G]=m.useState(null);m.useEffect(()=>{localStorage.removeItem("admin_titles_cache"),localStorage.removeItem("admin_titles_cache_time"),localStorage.removeItem("admin_featured_cache"),localStorage.removeItem("admin_featured_cache_time"),U(!0)},[]);const U=async(a=!1)=>{try{p(!0);const t=24*60*60*1e3,s=Date.now();let d=[];const v=localStorage.getItem("admin_titles_cache"),T=localStorage.getItem("admin_titles_cache_time");!a&&v&&T&&s-parseInt(T)<t?d=JSON.parse(v):(d=await q.getAllTitles(),localStorage.setItem("admin_titles_cache",JSON.stringify(d)),localStorage.setItem("admin_titles_cache_time",s.toString())),n(d);let b=[];const S=localStorage.getItem("admin_featured_cache"),A=localStorage.getItem("admin_featured_cache_time");!a&&S&&A&&s-parseInt(A)<t?b=JSON.parse(S):(b=await X.getFeaturedTitles(),localStorage.setItem("admin_featured_cache",JSON.stringify(b)),localStorage.setItem("admin_featured_cache_time",s.toString())),u(b);const K=Math.max(parseInt(localStorage.getItem("admin_titles_cache_time")||"0"),parseInt(localStorage.getItem("admin_featured_cache_time")||"0"));K>0&&G(new Date(K).toLocaleString())}catch(t){console.error("Error loading data:",t),ee.error("Error loading titles")}finally{p(!1)}},J=()=>{localStorage.removeItem("admin_titles_cache"),localStorage.removeItem("admin_titles_cache_time"),localStorage.removeItem("admin_featured_cache"),localStorage.removeItem("admin_featured_cache_time"),U(!0)},V=a=>{a.preventDefault(),f(r.trim()),j(1)},B=()=>{h(""),f(""),j(1)},H=a=>{x===a?R(C==="asc"?"desc":"asc"):(w(a),R("asc"))},Q=a=>x?[...a].sort((t,s)=>{let d,v;switch(x){case"title":d=t.title_name_en||t.title_name_kr||"",v=s.title_name_en||s.title_name_kr||"";break;case"genre":d=Array.isArray(t.genre)?t.genre.join(", "):t.genre||"",v=Array.isArray(s.genre)?s.genre.join(", "):s.genre||"";break;case"tone":d=t.tone||"",v=s.tone||"";break;case"keywords":const S=t.keywords||t.tags,A=s.keywords||s.tags;d=Array.isArray(S)?S.join(", "):S||"",v=Array.isArray(A)?A.join(", "):A||"";break;default:return 0}const T=String(d).toLowerCase(),b=String(v).toLowerCase();return T<b?C==="asc"?-1:1:T>b?C==="asc"?1:-1:0}):a,k=(()=>{let a=o;if(c){const{exactMatches:t,expandedMatches:s}=oe(o,c,ce());a=[...t,...s]}return Q(a)})();m.useEffect(()=>{j(1)},[c,x,C]);const I=a=>Array.isArray(a)?a.map(t=>t.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())).join(", "):a.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase()),L=({field:a,children:t,className:s=""})=>e.jsxs("button",{onClick:()=>H(a),className:`flex items-center gap-1 hover:text-gray-900 transition-colors ${s}`,children:[t,x===a?C==="asc"?e.jsx(se,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4 text-gray-400 opacity-60"})]}),M=Math.ceil(k.length/g),E=(y-1)*g,W=k.slice(E,E+g);return e.jsx(Z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-midnight-ink",children:"Titles Management"}),e.jsx("p",{className:"text-sm text-midnight-ink-600 mt-1",children:"Manage and browse all Korean content titles"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-midnight-ink-600 text-sm text-right",children:[e.jsxs("div",{className:"font-medium",children:[k.length," titles"]}),z&&e.jsxs("div",{className:"text-xs opacity-75",children:["Updated: ",new Date(z).toLocaleTimeString()]})]}),e.jsx(N,{asChild:!0,className:"bg-hanok-teal hover:bg-hanok-teal/90 text-white",children:e.jsx(D,{to:"/titles/new",children:"Add Title"})}),e.jsxs(N,{onClick:J,variant:"outline",disabled:l,children:[e.jsx(ae,{className:`w-4 h-4 mr-2 ${l?"animate-spin":""}`}),"Refresh"]})]})]}),i.length>0&&e.jsx(P,{children:e.jsxs($,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-midnight-ink mb-4",children:"Featured Titles"}),l?e.jsx("div",{className:"text-center text-gray-500 py-4",children:"Loading featured titles..."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:i.map(a=>{const t=a.titles;return e.jsx(D,{to:`/titles/${t.title_id}`,className:"block",children:e.jsxs(P,{className:"bg-white rounded-xl border-0 shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 group h-full flex flex-col",children:[e.jsx("div",{className:"aspect-[3/4] bg-gradient-to-br from-porcelain-blue-100 to-hanok-teal-100 flex items-center justify-center relative overflow-hidden",children:t.title_image?e.jsx("img",{src:t.title_image,alt:t.title_name_en||t.title_name_kr,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:s=>{s.currentTarget.style.display="none"}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 bg-hanok-teal rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-white rounded-lg flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 bg-hanok-teal rounded opacity-60"})})}),e.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 bg-hanok-teal rounded-full"})]})}),e.jsxs($,{className:"p-3 flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-sm font-bold text-midnight-ink mb-1 line-clamp-2",children:t.title_name_en||t.title_name_kr}),t.title_name_en&&t.title_name_kr&&e.jsx("p",{className:"text-xs text-midnight-ink-500 mb-1 line-clamp-1",children:t.title_name_kr}),e.jsx("p",{className:"text-xs text-midnight-ink-600 mb-2 line-clamp-2",children:t.tagline||t.pitch||"Discover this amazing Korean story"})]}),t.genre&&(Array.isArray(t.genre)?t.genre.length>0:!0)&&e.jsx("div",{className:"mt-auto",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Array.isArray(t.genre)?t.genre.slice(0,1).map((s,d)=>e.jsx("div",{className:"inline-block bg-hanok-teal/10 text-hanok-teal px-2 py-1 rounded-full text-xs font-medium",children:I(s)},`${t.title_id}-card-genre-${d}`)):e.jsx("div",{className:"inline-block bg-hanok-teal/10 text-hanok-teal px-2 py-1 rounded-full text-xs font-medium",children:I(t.genre)}),Array.isArray(t.genre)&&t.genre.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",t.genre.length-1]})]})})]})]})},a.id)})})]})}),e.jsx(P,{children:e.jsx($,{className:"p-4",children:e.jsxs("form",{onSubmit:V,className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search titles...",value:r,onChange:a=>h(a.target.value),className:"w-full pl-10 pr-24 py-2 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-hanok-teal focus:border-transparent text-midnight-ink"}),e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex gap-2",children:[c&&e.jsx(N,{type:"button",onClick:B,variant:"ghost",size:"sm",children:"Clear"}),e.jsx(N,{type:"submit",size:"sm",className:"bg-hanok-teal hover:bg-hanok-teal/90 text-white",children:"Search"})]})]})})}),e.jsx(P,{children:e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center text-sm font-medium text-gray-600",children:[e.jsx("div",{className:"col-span-1",children:"Image"}),e.jsx("div",{className:"col-span-3",children:e.jsx(L,{field:"title",children:"Title"})}),e.jsx("div",{className:"col-span-2",children:e.jsx(L,{field:"genre",children:"Genre"})}),e.jsx("div",{className:"col-span-2",children:e.jsx(L,{field:"tone",children:"Tone"})}),e.jsx("div",{className:"col-span-2",children:e.jsx(L,{field:"keywords",children:"Keywords"})}),e.jsxs("div",{className:"col-span-1 relative flex flex-col items-center justify-center",children:[e.jsx("span",{children:"Comps"}),e.jsx("span",{className:"bg-rose-200/70 text-rose-800 text-[8px] px-1.5 py-0.5 rounded-full font-medium mt-1",children:"PRO PLAN"})]}),e.jsxs("div",{className:"col-span-1 relative flex flex-col items-center justify-center",children:[e.jsx("span",{children:"Audience"}),e.jsx("span",{className:"bg-rose-200/70 text-rose-800 text-[8px] px-1.5 py-0.5 rounded-full font-medium mt-1",children:"PRO PLAN"})]})]})}),l?e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:"Loading titles..."}):k.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:W.map(a=>e.jsx(D,{to:`/titles/${a.title_id}`,className:"block",children:e.jsxs("div",{className:"px-6 py-4 grid grid-cols-12 gap-4 items-center hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"col-span-1",children:a.title_image?e.jsx("div",{className:"w-16 h-20 bg-gray-200 rounded-lg overflow-hidden",children:e.jsx("img",{src:a.title_image,alt:a.title_name_en||a.title_name_kr,className:"w-full h-full object-cover",onError:t=>{t.currentTarget.style.display="none",t.currentTarget.parentElement.classList.add("flex","items-center","justify-center"),t.currentTarget.parentElement.innerHTML='<span class="text-xs text-gray-400">No Image</span>'}})}):e.jsx("div",{className:"w-16 h-20 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("div",{className:"font-medium text-gray-800 line-clamp-1",children:a.title_name_en||a.title_name_kr}),a.title_name_en&&a.title_name_kr&&e.jsx("div",{className:"text-sm text-gray-500 line-clamp-1 mt-1",children:a.title_name_kr})]}),e.jsx("div",{className:"col-span-2",children:a.genre&&(!Array.isArray(a.genre)||a.genre.length>0)?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Array.isArray(a.genre)?a.genre.slice(0,2).map((t,s)=>e.jsx("div",{className:"inline-block bg-cyan-100 text-cyan-800 px-2 py-1 rounded-full text-xs font-medium",children:I(t)},`${a.title_id}-genre-${s}`)):e.jsx("div",{className:"inline-block bg-cyan-100 text-cyan-800 px-2 py-1 rounded-full text-xs font-medium",children:I(a.genre)}),Array.isArray(a.genre)&&a.genre.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.genre.length-2]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("div",{className:"col-span-2",children:a.tone?e.jsx("div",{className:"inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium",children:a.tone.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("div",{className:"col-span-2",children:a.tags&&a.tags.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.tags.slice(0,2).map((t,s)=>e.jsx("div",{className:"inline-block bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs font-medium",children:t},`${a.title_id}-tag-${s}`)),a.tags.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.tags.length-2]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(F,{className:"col-span-1",children:a.comps?e.jsx("div",{className:"inline-block bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium",children:a.comps}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(F,{className:"col-span-1",children:a.audience?e.jsx("div",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium",children:a.audience}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})},a.title_id))}):e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:c?"No titles found matching your search.":"No titles available."}),M>1&&e.jsx("div",{className:"border-t border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",E+1," to ",Math.min(E+g,k.length)," of ",k.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>j(a=>Math.max(a-1,1)),disabled:y===1,className:"text-midnight-ink-600 border-porcelain-blue-300 hover:bg-porcelain-blue-100",children:"Previous"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,M)},(a,t)=>{const s=t+1;return e.jsx(N,{variant:y===s?"default":"outline",size:"sm",onClick:()=>j(s),className:y===s?"bg-hanok-teal text-white hover:bg-hanok-teal/90":"text-midnight-ink-600 border-porcelain-blue-300 hover:bg-porcelain-blue-100",children:s},s)})}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>j(a=>Math.min(a+1,M)),disabled:y===M,className:"text-midnight-ink-600 border-porcelain-blue-300 hover:bg-porcelain-blue-100",children:"Next"})]})]})})]})})]})})}export{be as default};
