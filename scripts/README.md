# KStoryBridge Keyword Extraction Scripts

This directory contains scripts for extracting meaningful keywords from titles in the KStoryBridge database to help buyers discover content suitable for film/TV adaptation.

## Files

### Core Scripts
- **`keyword-extractor.js`** - Main keyword extraction script with advanced filtering
- **`generate-keyword-updates.js`** - Generates SQL update statements from extraction results
- **`package.json`** - Node.js dependencies

### Generated Files
- **`update-keywords-complete.sql`** - Complete SQL script to update the titles table
- **`keyword-extraction-results-*.json`** - Detailed extraction results with metadata

## Features

### Multi-layered Keyword Extraction
1. **Text-based keywords** - Extracted from synopsis, tagline, pitch, and title fields
2. **Genre-based keywords** - Mapped to specific themes and adaptation elements
3. **Content format keywords** - Indicating visual adaptation potential
4. **Thematic keywords** - Emotional and narrative elements
5. **Korean cultural keywords** - For Korean content recognition

### Advanced Filtering System
The script filters out non-sensical keywords including:
- **URLs and file paths** (e.g., Supabase storage URLs)
- **UUIDs and random strings** (e.g., database IDs)
- **Technical terms** (file extensions, technical IDs)
- **Common stop words** (expanded list of 60+ words)
- **Very long strings** (>30 characters, likely technical)
- **Strings with excessive consonants** (likely technical jargon)

### Content Analysis
- **Korean/English bilingual support**
- **Adaptation potential scoring** (visual, character-driven, universal appeal)
- **Production complexity indicators**
- **Cultural specificity detection**

## Usage

### 1. Extract Keywords
```bash
npm install
node keyword-extractor.js
```

### 2. Generate SQL Updates
```bash
node generate-keyword-updates.js
```

### 3. Apply to Database
```sql
-- Execute the generated SQL file in your Supabase database
-- File: update-keywords-complete.sql
```

## Results Summary

### Latest Extraction (2025-08-07)
- **üìö 245 titles processed**
- **üîç 2,718 keywords extracted** (avg: 11 per title)  
- **‚úÖ All titles** received keyword updates
- **üé≠ 88 unique genres** identified
- **üö´ 0 problematic URLs** included (filtered out)

### Top Content Categories
1. **Romance** (78 titles total across variants)
2. **LGBTQ+ content** (24 titles)
3. **Fantasy** (29 titles across variants)
4. **Drama** (34 titles across variants)

### Most Common Keywords
1. `webtoon`, `visual storytelling`, `episodic structure` (format-based)
2. `love`, `romance`, `relationship` (romance themes)
3. `fantasy`, `supernatural`, `magic` (fantasy elements)
4. `story`, `drama`, `character` (narrative elements)

## Database Schema

The script adds a `keywords` column to the `titles` table:

```sql
ALTER TABLE titles ADD COLUMN keywords text[];
COMMENT ON COLUMN titles.keywords IS 'Extracted keywords for content discovery and search';
```

## Search Applications

Buyers can now search titles using:
- **Thematic content**: `romance`, `revenge`, `family`, etc.
- **Visual elements**: `action sequences`, `special effects`
- **Production scope**: `high budget`, `intimate story`, `epic scope`
- **Cultural markers**: Korean cultural elements, universal themes
- **Format advantages**: `visual storytelling`, `episodic structure`

## Quality Assurance

### Filtering Verification
- ‚úÖ No URLs like `httpsdlrnrgcoguxlkkcitlpdsupabaseco...`
- ‚úÖ No technical IDs or random strings
- ‚úÖ No file extensions or paths
- ‚úÖ Meaningful keywords only (length 3-30 characters)
- ‚úÖ Cultural and language-appropriate terms preserved

### Manual Review Recommended
1. Review generated SQL file before execution
2. Test queries on sample data
3. Validate keyword relevance for your use case
4. Consider adding domain-specific terms to extraction patterns

## Contributing

To improve keyword extraction:
1. Update `KEYWORD_PATTERNS` for new thematic categories
2. Expand `KOREAN_KEYWORDS` for better Korean content support  
3. Adjust `FILTER_PATTERNS` for your specific filtering needs
4. Test with sample data before running on full dataset

---

**Generated by KStoryBridge Keyword Extraction System**  
*Helping buyers discover the perfect stories for adaptation*